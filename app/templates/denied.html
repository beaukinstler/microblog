{% extends "base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block app_content %}
    <h1>{{ title }}</h1>
    <h2 class="pollingPlaceDetails" hidden >Polling Place Lookup</h2>
    <span class="pollingPlaceDetails" id="pollingPlaces" hidden></span>
    <div class="row">
        <div class="col-md-4">
            <div>
                <input id="clickMe" type="button" value="Look up polling place based on personal address" onclick="getPolls();" />
            </div>
                <!-- <a href="javascript:getPolls(
                    
                    '#optPersonStreet',
                    '#optPersonCity',
                    '#optPersonState',
                    '#optPersonZip',
                    '#electionId');">Look up polling place based on personal address</a> -->
                    <div id="statusIcon" ></div>
            {{ wtf.quick_form(form) }}
        </div>
    </div>


    <h2>Denials Logged:</h2>
    {% for denial in denials %}
    <div class="row">{{ denial }} </div>
    {% endfor %}
    {% include '_paginate_denials.html' %}

    <script>
        function getPolls() {
            var destElem = $('#pollingPlaces');
            $('.pollingPlaceDetails').removeAttr('hidden');
            $(destElem).html('<img style="width:50px;height:60px;" src="{{ url_for('static', filename='loading.gif') }}">');
            $.post('/polling_place', {
                street: $('#optPersonStreet').val(),
                city: $('#optPersonCity').val(),
                state: $('#optPersonState').val(),
                zip: $('#optPersonZip').val(),
                electionId: $('#electionId').val()
            }).done(function(response_from_polling){
                console.log(response_from_polling.json)
                if ( response_from_polling == undefined){ console.log("No response from /polling_place");}
                else if (response_from_polling.error == undefined ){
                    var name = response_from_polling.pollingLocations[0].address.locationName;
                    var street = response_from_polling.pollingLocations[0].address.line1;
                    var city = response_from_polling.pollingLocations[0].address.city;
                    var state = response_from_polling.pollingLocations[0].address.state;
                    var zip = response_from_polling.pollingLocations[0].address.zip;
                    
                    $(destElem).html(name +"<br>" + street  +"<br>" + zip);
                    $('#statusIcon').html("");
                    $('#pollName').val(name);
                    $('#pollStreet').val(street);
                    $('#pollCity').val(city);
                    $('#pollState').val(state);
                    $('#pollZip').val(zip);
                    $('.pollingPlaceDetails').removeAttr('hidden');
                }
                else {
                    $(destElem).html(
                        "***That address isn't available in the public records**** <br>"
                        + "Please manually enter the polling location info as bast as you can.<br>"
                    );
                }
            }).fail(function() {
                console.log("Failed to call out to Google Civic")
                $(destElem).text("Server error... Please manually look up polling place details")
            });
        }
    </script>
{% endblock %}